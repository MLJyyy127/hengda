{% extends "base.html" %}
{% load static %}

{% block title %}
产品详情
{% endblock %}

{% block content %}
<link href="{% static 'css/products.css' %}" rel="stylesheet">

<div class="container"> 
    <div class="row">
        <!-- 产品图片区域 -->
        <div class="col-md-6">
            {% comment %} 主图 {% endcomment %}
            <div class="main-image-container">
                {% for img in product.productImgs.all %}
                    {% if forloop.first %}
                    <img class="img-responsive main-product-image" src="{{img.photo.url}}" alt="{{product.title}}" data-image-id="{{img.id}}">
                    {% endif %}
                {% endfor %}
            </div>
            {% comment %} 缩略图 {% endcomment %}
            <div class="thumbnail-list">
                {% for img in product.productImgs.all %}
                <div class="thumbnail-item {% if forloop.first %}active{% endif %}" data-image-src="{{img.photo.url}}" data-image-id="{{img.id}}">
                    <img src="{{img.photo.url}}" alt="{{product.title}}-图片{{forloop.counter}}">
                </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- 产品信息区域 -->
        <div class="col-md-6">
            <div class="product-info">
                <h1 class="product-title">{{product.title}}</h1>
                <div class="product-price">
                    <span class="price">￥{{product.price}}</span>
                </div>
                
                <!-- 数量选择 -->
                <div class="product-option">
                    <h3>数量</h3>
                    <div class="quantity-selector">
                        <button class="quantity-btn minus">-</button>
                        <input type="text" class="quantity-input" value="1">
                        <button class="quantity-btn plus">+</button>
                    </div>
                </div>
                
                <!-- 加入购物车按钮 -->
                <div class="add-to-cart-container">
                    <button class="btn-add-to-cart">加入购物车</button>
                </div>
            </div>

            
        </div>

        <div class="col-md-6">
            <div class="card" style="margin-top: 20px;">
                <div class="card-header bg-primary text-white hot-title">
                    <i class="fa fa-fire">热门产品推荐</i> 
                </div>
                <ul class="list-group list-group-flush">
                    {% for hot in hot_products %}
                    <li class="list-group-item">
                        <a href="{% url 'productsApp:productDetail' hot.id %}" style="text-decoration: none; color: #333;">
                            <span class="badge badge-pill badge-danger">{{ forloop.counter }}</span> 
                            {{ hot.title|truncatechars:15 }}
                            <small class="text-muted pull-right"><i class="fa fa-eye"></i> {{ hot.views }}</small>
                        </a>
                    </li>
                    {% empty %}
                    <li class="list-group-item">暂无数据</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>


    
    <!-- 产品介绍 -->
    <div class="row product-description-section">
        <div class="col-md-12">
            <div class="product-description">
                <h2>产品介绍</h2>
                <div class="description-content">
                    {{product.description|linebreaks}}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // 缩略图点击切换功能
    document.querySelectorAll('.thumbnail-item').forEach(thumbnail => {
        thumbnail.addEventListener('click', function() {
            // 移除所有active类
            document.querySelectorAll('.thumbnail-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // 添加active类到当前点击的缩略图
            this.classList.add('active');
            
            // 更新主图
            const mainImage = document.querySelector('.main-product-image');
            const imageSrc = this.getAttribute('data-image-src');
            const imageId = this.getAttribute('data-image-id');
            
            mainImage.src = imageSrc;
            mainImage.setAttribute('data-image-id', imageId);
        });
    });
    // 数量增减功能
    const minusBtn = document.querySelector('.quantity-btn.minus');
    const plusBtn = document.querySelector('.quantity-btn.plus');
    const quantityInput = document.querySelector('.quantity-input');
    
    minusBtn.addEventListener('click', function() {
        let value = parseInt(quantityInput.value);
        if (value > 1) {
            quantityInput.value = value - 1;
        }
    });
    
    plusBtn.addEventListener('click', function() {
        let value = parseInt(quantityInput.value);
        quantityInput.value = value + 1;
    });
</script>

{% endblock %}